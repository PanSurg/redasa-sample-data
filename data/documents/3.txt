# URL to online version

https://doi.org/10.1016/j.compbiomed.2020.103792
https://api.elsevier.com/content/article/pii/S0010482520301621
https://www.sciencedirect.com/science/article/pii/S0010482520301621?v=s5


# Title

Automated detection of COVID-19 cases using deep neural networks with X-ray images


# Abstract

Abstract The novel coronavirus 2019 (COVID-2019), which first appeared in Wuhan city of China in December 2019, spread rapidly around the world and became a pandemic. It has caused a devastating effect on both daily lives, public health, and the global economy. It is critical to detect the positive cases as early as possible so as to prevent the further spread of this epidemic and to quickly treat affected patients. The need for auxiliary diagnostic tools has increased as there are no accurate automated toolkits available. Recent findings obtained using radiology imaging techniques suggest that such images contain salient information about the COVID-19 virus. Application of advanced artificial intelligence (AI) techniques coupled with radiological imaging can be helpful for the accurate detection of this disease, and can also be assistive to overcome the problem of a lack of specialized physicians in remote villages. In this study, a new model for automatic COVID-19 detection using raw chest X-ray images is presented. The proposed model is developed to provide accurate diagnostics for binary classification (COVID vs. No-Findings) and multi-class classification (COVID vs. No-Findings vs. Pneumonia). Our model produced a classification accuracy of 98.08% for binary classes and 87.02% for multi-class cases. The DarkNet model was used in our study as a classifier for the you only look once (YOLO) real time object detection system. We implemented 17 convolutional layers and introduced different filtering on each layer. Our model (available at (https://github.com/muhammedtalo/COVID-19)) can be employed to assist radiologists in validating their initial screening, and can also be employed via cloud to immediately screen patients.


# Main text

COVID-19 presentation, which began with the reporting of unknown causes of pneumonia in Wuhan, Hubei province of China on December 31, 2019, has rapidly become a pandemic [[1], [2], [3]]. The disease is named COVID-19 and the virus is termed SARS-CoV-2. This new virus spread from Wuhan to much of China in 30 days [4]. The United States of America [5], where the first seven cases were reported on January 20, 2020, reached over 300,000 by the 5th of April 2020. Most coronaviruses affect animals, but they can also be transmitted to humans because of their zoonotic nature. Severe acute respiratory syndrome Coronavirus (SARS-CoV) and the Middle East respiratory syndrome Coronavirus (MERS-CoV) have caused severe respiratory disease and death in humans [6]. The typical clinical features of COVID-19 include fever, cough, sore throat, headache, fatigue, muscle pain, and shortness of breath [7].

The most common test technique currently used for COVID-19 diagnosis is a real-time reverse transcription-polymerase chain reaction (RT-PCR). Chest radiological imaging such as computed tomography (CT) and X-ray have vital roles in early diagnosis and treatment of this disease [8]. Due to the low RT-PCR sensitivity of 60%–70%, even if negative results are obtained, symptoms can be detected by examining radiological images of patients [9,10]. It is stated that CT is a sensitive method to detect COVID-19 pneumonia, and can be considered as a screening tool with RT-PRC [11]. CT findings are observed over a long interval after the onset of symptoms, and patients usually have a normal CT in the first 0–2 days [12]. In a study on lung CT of patients who survived COVID-19 pneumonia, the most significant lung disease is observed ten days after the onset of symptoms [13].

At the beginning of the pandemic, Chinese clinical centers had insufficient test kits, which are also producing a high rate of false-negative results, so doctors are encouraged to make a diagnosis only based on clinical and chest CT results [12,14]. CT is widely used for COVID-19 detection in countries such as Turkey, where a low number of test kits at onset of the pandemic were available. Researchers state that combining clinical image features with laboratory results may help in early detection of COVID-19 [6,11,[15], [16], [17]]. Radiologic images obtained from COVID-19 cases contain useful information for diagnostics. Some studies have encountered changes in chest X-ray and CT images before the beginning of COVID-19 symptoms [18]. Significant discoveries have been realized by investigators in imaging studies of COVID-19. Kong et al. [6] observed right infrahilar airspace opacities in a COVID-19 patient. Yoon et al. [19] reported that one in three patients studied had a single nodular opacity in the left lower lung region. In contrast, the other two had four and five irregular opacities in both lungs. Zhao et al. [16] not only found ground-glass opacities (GGO) or mixed GGO in most of the patients, but they also observed a consolidation, and vascular dilation in the lesion. Li and Xia [17] reported GGO and consolidation, interlobular septal thickening and air bronchogram sign, with or without vascular expansion, as common CT features of COVID-19 patients. Peripheral focal or multifocal GGO affecting both lungs in 50%–75% of patients is another observation [9]. Similarly, Zu et al. [8] and Chung et al. [6] discovered that 33% of chest CTs can have rounded lung opacities. In Fig. 1
, chest X-ray images taken at days 1, 4, 5 and 7 for a 50-year-old COVID-19 patient with pneumonia are given, and explanations of these images are also provided [20].

Application of machine learning methods for automatic diagnosis in the medical field have recently gained popularity by becoming an adjunct tool for clinicians [[21], [22], [23], [24], [25]]. Deep learning, which is a popular research area of artificial intelligence (AI), enables the creation of end-to-end models to achieve promised results using input data, without the need for manual feature extraction [26,27]. Deep learning techniques have been successfully applied in many problems such as arrhythmia detection [[28], [29], [30]], skin cancer classification [31,32], breast cancer detection [33,34], brain disease classification [35], pneumonia detection from chest X-ray images [36], fundus image segmentation [37], and lung segmentation [38,39]. The COVID-19 epidemic's rapid rise has necessitated the need for expertise in this field. This has increased interest in developing the automated detection systems based on AI techniques. It is a challenging task to provide expert clinicians to every hospital due to the limited number of radiologists. Therefore, simple, accurate, and fast AI models may be helpful to overcome this problem and provide timely assistance to patients. Although radiologists play a key role due to their vast experience in this field, the AI technologies in radiology can be assistive to obtain accurate diagnosis [40]. Additionally, AI approaches can be useful in eliminating disadvantages such as insufficient number of available RT-PCR test kits, test costs, and waiting time of test results.

Recently, many radiology images have been widely used for COVD-19 detection. Hemdan et al. [41] used deep learning models to diagnose COVID-19 in X-ray images and proposed a COVIDX-Net model comprising seven CNN models. Wang and Wong [42] proposed a deep model for COVID19 detection (COVID-Net), which obtained 92.4% accuracy in classifying normal, non-COVID pneumonia, and COVID-19 classes. Ioannis et al. [43] developed the deep learning model using 224 confirmed COVID-19 images. Their model achieved 98.75% and 93.48% success rates for two and three classes, respectively. Narin et al. [44] achieved a 98% COVID-19 detection accuracy using chest X-ray images coupled with the ResNet50 model. Sethy and Behera [45] classified the features obtained from various convolutional neural network (CNN) models with support vector machine (SVM) classifier using X-ray images. Their study states that the ResNet50 model with SVM classifier provided the best performance. Finally, there are also several recent studies on COVID-19 detection that employed various deep learning models with CT images [[46], [47], [48], [49], [50], [51]].

In this study, a deep learning model is proposed for the automatic diagnosis of COVID-19. The proposed model has an end-to-end architecture without using any feature extraction methods, and it requires raw chest X-ray images to return the diagnosis. This model is trained with 125 chest X-ray images, which are not in a regular form and were obtained hastily. Diagnostic tests performed after 5–13 days are found to be positive in recovered patients [52]. This crucial finding shows us that recovered patients may continue to spread the virus. Therefore, more accurate methods for the diagnosis is needed. One of the most important disadvantages of chest radiography analyses is an inability to detect the early stages of COVID-19, as they do not have sufficient sensitivity in GGO detection [8]. However, well-trained deep learning models can focus on points that are not noticeable to the human eye, and may serve to reverse this perception.

In this study, X-ray images obtained from two different sources were used for the diagnosis of COVID-19. A COVID-19 X-ray image database was developed by Cohen JP [53] using images from various open access sources. This database is constantly updated with images shared by researchers from different regions. At present, there are 127 X-ray images diagnosed with COVID-19 in the database. Fig. 2
shows a few COVID-19 cases obtained from the database and the findings of the experts.

There are 43 female and 82 male cases in the database that were found to be positive. In this dataset, a complete metadata is not provided for all patients. The age information of 26 COVID-19 positive subjects is given, and the average age of these subjects is approximately 55 years. Also, the ChestX-ray8 database provided by Wang et al. [58] was used for normal and pneumonia images. In order to avoid the unbalanced data problem, we used 500 no-findings and 500 pneumonia class frontal chest X-ray images randomly from this database.

The advent of deep learning technology has revolutionized artificial intelligence [26,27]. The word deep refers to the increase in the size of this network with the number of layers. The structure is named after convolution, a mathematical operator. A typical CNN structure has a convolution layer that extracts features from the input with the filters it applies, a pooling layer to reduce the size for computational performance, and a fully connected layer, which is a neural network. By combining one or more such layers, a CNN model is created, and its internal parameters are adjusted to accomplish a particular task, such as classification or object recognition.

Instead of initiating a deep model development from scratch, a more rational approach is to construct a model using already proven models. Therefore, while designing the deep model used in this study, the Darknet-19 model [59] is chosen as the starting point. Darknet-19 is the classifier model that forms the basis of a real-time object detection system named YOLO (You only look once) [59]. This system has the state-of-the-art architecture designed for object detection. The DarkNet classifier is used on the basis of this successful architecture. We designed the DarkCovidNet architecture (available at https://github.com/muhammedtalo/COVID-19), inspired by the DarkNet architecture that has proven itself in deep learning, instead of building a model from scratch. We have used fewer layers and filters as compared to the original DarkNet architectures. We gradually increased the number of filters such as to 8, 16, 32. To better understand this new model, it is helpful to understand the basics of the Darknet-19, which consists of 19 convolutional layers and five pooling layers, using Maxpool. These layers are typical CNN layers with different filter numbers, sizes, and stride values. Let the letter C denote a convolutional layer, and M denote a Maxpool layer. As C
1 is taken as the input layer, Darknet-19 has a layer layout as follows.C1-M1-C2-M2-C3-C4-C5-M3-C6-C7-C8-M4-C9-C10-C11-C12-C13-M5-C14-C15-C16-C17-C18-C19


For input signal X (image) and kernel K, the two-dimensional convolution operation can be defined as follows.(1)(X∗K)(i,j)=∑m∑nK(m,n)X(i−m,j−n)where * represents the discrete convolution operation. The K matrix slides over the input matrix with stride parameter. The Leaky rectified linear unit (Leaky ReLu) is used as an activation function in the DarkNet architecture. The calculation of the leaky ReLu function is given in equation (2).(2)f(x)=0.01xfor x<0xfor x≥0


A schematic presentation for the flow of input data from convolution layer (C) and Max-pooling (M) layer, respectively, is given in Fig. 3
.

This model ends with Avgpool and Softmax layers that produce the outputs. Eventually, a deep model with large number of layers is essential for the feature extraction of a real-time object detection system. In this study, we encountered a problem in classifying the images with subtle details. The model performing such classification should have a structure which can capture and learn small differences rather than being very deep, like ResNets or ResNext [60] models. An illustration of the proposed model used in this study is shown in Fig. 4
.

The proposed model has 17 convolution layers. In Fig. 4, each DN (DarkNet) layer has one convolutional layer followed by BatchNorm, and LeakyReLU operations, while each 3 × Conv layer has the same setup three times in successive form. The batch normalization operation is used to standardize the inputs, and this operation has other benefits, such as reducing training time and increasing stability of the model. LeakyReLU is a variation of the ReLU operation used to prevent dying neurons. Unlike ReLU or sigmoid activation functions, which have zero value in the negative part of their derivatives, LeakyReLU has a small epsilon value to overcome the dying neuron problem. Similar to the Darknet-19 model, the Maxpool method is used in all the pooling operations. Maxpool downsizes an input by taking the maximum of a region determined by its filter. When working with two classes, the proposed model performs the COVID-19 detection task. If three different classes of images are used in the input, the same model performs the classification task to determine the labels of the input chest X-ray images as COVID-19, Pneumonia, or No-Findings. Finally, the layer details and layer parameters of the model are given in Table 1
. The developed deep learning model consists of 1,164,434 parameters. We have used the Adam optimizer for weight updates, cross entropy loss function and selected learning rate as 3e-3.

We performed experiments to detect and classify COVID-19 using X-ray images in two different scenarios. First, we have trained the DarkCovidNet deep learning model to classify X-ray images into three categories: COVID-1, No-Findings, Pneumonia. Secondly, the DarkCovidNet model is trained to detect two classes: COVID-19 and No-Findings categories. The performance of the proposed model is evaluated using the 5-fold cross-validation procedure for both the binary and triple classification problem. Eighty percent of X-ray images are used for training and 20% for validation. The experiments are repeated five times as shown in Fig. 5
. All of the split k pieces are wrapped in folds to use in the validation stage. We have trained DarkCovidNet for 100 epochs. In Fig. 6
The training and validation loss graphs of the multi-class classification and validation accuracy graphs are shown for the Fold-1.

It can be noted from Fig. 6 that there is a significant increase in loss values in the beginning of the training, which decrease substantially in the later stage of the training. The main reason for this sharp increase and decrease is attributed to the number of data in the COVID-19 class, which is far less than the other two (Pneumonia and No-Findings) classes. However, when the deep model examines all X-ray images over and over again for each epoch during the training, these rapid ups and downs are slowly reduced in the later part of the training.

The multi-class classification performance of the DarkCovidNet model has been evaluated for each fold, and the average classification performance of the model is calculated. The overlapped as well as each separate confusion matrix (CM) are shown in Fig. 7
. The overlapped CM is created using the sum of CMs obtained in all folds. Thus, it is aimed to obtain an idea about the general perforations of the model. The DarkCovidNet model achieved an average classification accuracy of 87.02% to classify: no findings, COVID-19, and Pneumonia categories. Sensitivity, specificity, precision, F1-score, and accuracy values are shown in Table 2
for the detail analysis of the model for the 3-class problem.

It can be noted from the overlapped confusion matrix of the multi-class classification task that the deep learning model classified COVID-19 better than the classes of pneumonia and no findings. The obtained sensitivity, specificity, and F1-score values are 85.35%, 92.18%, and 87.37%, respectively.

Secondly, the result of confusion matrixes for the binary classification problem in detecting COVID-19 positive are shown in Fig. 8
. In addition, sensitivity, specificity precision, F1-score, and accuracy results for the binary classification task are given in Table 3
.

It can be noted from Table 3 that the proposed model has achieved an average accuracy of 98.08% in detecting COVID-19 and the obtained average sensitivity, specificity, and F1-score values of 95.13%, 95.30%, and 96.51%, respectively.

This section includes the interpretation of results of the DarkCovidNet model by an expert radiologist. The DarkCovidNet model is designed for the automatic detection of COVID-19 using X-ray images, without requiring any handcrafted feature extraction techniques. The developed model helps to provide a second opinion to expert radiologists in health centers. It may significantly reduce the workload of clinicians and assist them to make an accurate diagnosis in their daily routine work. The proposed model can save time (the diagnostic process is fast); hence specialists can focus on more critical cases. In this work, we have shared the outputs of the model with expert radiologists to confirm model robustness. We shared the top prediction errors of the model and the actual labels of the X-ray dataset with radiologists. Additionally, we also used the Grad-CAM [61] heat map approach to visually depict decisions made by the deep model. The heatmap highlights important areas that the model emphasizes on the X-ray. In this way, we have ensured that the outcome of the model is approved by a radiologist. In the clinical setting, an illustration of the model which can provide the second opinion to radiologists is shown in Fig. 9
.

The radiologist comments on the output of DarkCovidNet model are as follows:-The model performed outstandingly in detecting COVID-19 cases for the binary class task.-The DarkCovidNet model is successful in detecting COVID-19 findings.-Clinically, pneumonia images are also later included in the study. Therefore, the model evaluated patients with COVID-19 as pneumonia. Since COVID-19 pneumonia is a subset of pneumonia diseases evaluated by the model, the diagnosis is correct, although the interpretation seems to be incorrect. Therefore, patients identified as COVID-19 are evaluated as pneumonia (see Fig. 10 (a)). For this reason, the success rate of the model in the multi-class classification problem is relatively low as compared to the binary class.-The model is sensitive in detecting pneumonia disease. Although the model can predict pneumonia positively and marked as no findings in the dataset, this patient has a mass (see Fig. 10 (b)).-The model made the incorrect predictions in poor quality X-ray imagery and in patients with acute respiratory distress syndrome (ARDS), in which the lung image is diffuse and much lung ventilation is lost (see Fig. 10 (c)).-The model is useful to detect COVID-19 with presence of a heat map in normal subjects. Its effectiveness diminishes in pneumonia and ARDS cases. The heat map showed a greater concentration area in the X-rays of patients with COVID-19 than the area in which the disease is not seen (see Fig. 11).-The model may be more useful evaluate the efficacy of treatment based on the heatmap. It can also assist experts in terms of diagnosis, follow-up, treatment, and isolation of patients.



Fig. 12
shows the difference between a few COVID and pneumonia case images. The following primary findings are frequently observed in the chest X-rays of COVID-19 patients [15].•Ground-glass opacities (GGO) (bilateral, multifocal, subpleural, peripheral, posterior, medial and basal).•A crazy paving appearance (GGOs and inter-/intra-lobular septal thickening).•Air space consolidation.•Bronchovascular thickening (in the lesion).•Traction bronchiectasis.


Similarly, chest X-ray findings of pneumonia patients are observed as follows [62].•Ground-glass opacities (GGO) central distribution, unilateral•Reticular opacity•Vascular thickening•Distribution more along the bronchovascular bundle•Bronchial wall thickening


In COVID-19, isolated lobar or segmental consolidation without GGO, multiple tiny pulmonary nodules, tree-in-bud, pneumothorax, cavitation, and hilar lymphadenopathy smoother interlobular septal thickening with pleural effusion are rare, while these findings can often be seen in pneumonia [9].

In the COVID-19 epidemic, radiological imaging plays an important role in addition to the diagnostic tests performed for the early diagnosis, treatment, and isolation stages of the disease. Chest radiography can detect a few characteristic findings in the lung associated with COVID-19. Deep learning models are sensitive in detecting COVID-19 lung involvement and hence the diagnostic accuracy rate is high. During the evaluation of the model, X-ray radiographs of COVID-19 patients confirmed positive by the PCR Test are used. The model can easily detect GGO, consolidation areas, and nodular opacities, which are the pathognomic findings of patients for COVID-19 on X-ray radiography. In COVID-19, bilateral, lower lobe, and peripheral involvement is observed, and the proposed model can detect localization of the lesion. These models are particularly important in identifying early stages of COVID-19 patients. Early diagnosis of the disease is important to provide immediate treatment and to prevent disease transmission. The models can also play an indispensable role in patients lacking early symptoms. There is a margin of error in patients with diffuse late lung parenchyma and in patients with significantly reduced lung ventilation due to poor quality X-ray images. X-rays that are not of optimal quality are difficult to evaluate by radiologists. The clinical and radiological images of later-stage patients are well established and it is easier to detect the findings by experts. The role of deep learning models is more prominent in screening and diagnosis when the infection is at its early stages.

The models can be readily used in healthcare centers. There is no need to wait long hours for the radiologists to screen the images. Thus, healthcare workers and patient relatives can focus on isolation of suspicious cases so that treatment can begin. Hence, the spread of the disease can be significantly reduced. The patients can seek a second opinion if they are diagnosed as positive by our system. Hence, waiting time can be significantly reduced, and it will alleviate clinician workload.

Dr. Cohen has compiled the radiology images from various sources of COVID-19 cases for researches to develop an accurate model to diagnose this disease accurately [53]. Most of the studies mentioned in this part of the article used the COVID-19 image data from this source, and for other cases, such as Non-COVID-19, images are obtained from various publically available sources. Hemdan et al. [41] proposed COVIDX-Net to diagnose COVID-19 in X-ray images. They have obtained 90% accuracy rate using 25 COVID-19 positive and 25 normal images. Wang and Wong [42] designed COVID-Net, a deep learning-based model, for COVID19 detection. COVID-Net achieved a 92.4% success rate using a total of 16,756 radiography images obtained from different open access data. Transfer learning, which has gained increasing attention, is used by Ioannis et al. [43] for the same purpose as COVID-Net. In this study, 224 approved COVID-19, 700 pneumonias, and 504 normal radiology images are used. They achieved a 98.75% performance for the 2-class and 93.48% performance for the 3-class problem. Narin et al. [44] employed three different CNN models (ResNet50, InceptionV3, and InceptionResNetV2) using 50 open access COVID-19 chest X-ray images [53] shared by Joseph Cohen and 50 normal images taken from the Kaggle repository [63]. However, in this study, non-COVID images are images belonging to children between the ages of 1–5 years.

The researchers also attempted different models and combinations of various methodologies. Sethy and Behera [45] used CNN models to extract image features and then classified them using the SVM classifier. In this study, a 95.38% accuracy was achieved using ResNet50 and SVM in combination with 50 images. Ying et al. achieved a 86% success rate using CT images with a deep model built on the pre-trained ResNet50, termed DRE-Net [46]. Wang et al. [47] achieved a classification accuracy of 82.9% using the modified Inception (M-Inception) deep model developed using CT images. Zheng et al. [48] proposed a three-dimensional deep CNN model to detect COVID-19 from CT imagery and reported a 90.8% accuracy. Xu et al. [49] achieved an 86.7% performance rate in detecting COVID-19 using ResNet coupled with CT images. Most of these earlier studies have few data to develop the model.

In this study, a deep learning model called DarkCovidNet was used for the detection of COVID-19. We have used a total of 1125 images (125 COVID-19(+), 500 Pneumonia and 500 No-Findings) to develop our model. We obtained an accuracy of 98.08% and 87.02% for binary and three classes, respectively. We obtained superior performance compared to other studies in the literature (Table 4
).

The COVID-19 public image data has limited data, which is a limitation of this study. Public sources from X-ray images are constantly updated. Few studies conducted prior to this study have used 25 and 50 images in each class [41,42,44,45]. In this study, a total of 125 COVID-19 positive data are used. In previous studies, common techniques such as VGG and ResNet are generally used. However, the proposed new model is based on the DarkNet method. In addition, an effective screening process is required to eliminate images that are not useful present in the database. Since COVID-19 is a new epidemic, fewer X-ray images are available for developing the automated diagnostic system. The main advantages of the model are as follows:-The model classified chest X-ray images without using a feature extraction technique.-It is an effective approach that can assist experts for diagnosis.-The heatmaps produced by the model are evaluated by an expert radiologist. The model focuses on localizing effective regions on chest X-ray images.


The proposed model can be used for the diagnosis of COVID-19 using X-ray radiographs. X-ray radiographs are preferred because they are readily accessible for disease diagnosis. They are widely used in health centers worldwide during the pandemic. The model has the ability to diagnose COVID-19 within seconds. CT is a costly process and not readily accessible as they are usually only located in larger health centers. In addition, when CT is compared to X-ray, the amount of radiation received by the patient is more. Hence, it is recommended to use a deep learning model with X-ray imagery, as it is more accessible with lower radiation dose as compared to CT. Patients diagnosed as COVID positive by the model can be directed to advanced centers for confirmation, followed by treatment without delay. In addition, patients who have been diagnosed negatively by the model can be prevented from undergoing PCR tests and occupying health centers unnecessarily.

In the future, we intend to validate our model by incorporating more images. This developed model can be placed in a cloud to provide diagnosis instantly and to help rehabilitate affected patients immediately. This should reduce clinician workload significantly. We will address CT images for COVID-19 detection and compare the obtained results with the proposed model trained using X-ray images. Also, we will try to collect local radiology images for COVID-19 cases and evaluate them with our model from sites in Turkey. After the necessary tests are done, we aim to deploy the developed model in local hospitals for screening.

In this study, we have proposed a deep learning based model to detect and classify COVID-19 cases from X-ray images. Our model is fully automated with an end-to-end structure without the need for manual feature extraction. Our developed system is able to perform binary and multi-class tasks with an accuracy of 98.08% and 87.02%, respectively. The performance of the developed model is assessed by expert radiologists and is ready to be tested with a larger database. This system can be used in remote places in countries affected by COVID-19 to overcome a shortage of radiologists. Also, such models can be used to diagnose other chest-related diseases including tuberculosis and pneumonia. A limitation of the study is the use of a limited number of COVID-19 X-ray images. We intend to make our model more robust and accurate by using more such images from our local hospitals.

The authors declare no conflicts of interest.


